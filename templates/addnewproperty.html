{% extends 'base.html' %}

{% block content %}

<!-- Container Section -->
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Card Section -->
            <div class="card shadow">
                
                <!-- Header Section -->
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">Add New Property</h3>
                </div>
                
                <!-- Form Section -->
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
                        {% csrf_token %}
                        
                        <!-- Table for Form Fields -->
                        <table class="table table-borderless">
                            {% for field in form %}
                                <tr>
                                    <!-- Label Column -->
                                    <td style="width: 20%;">
                                        <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                                    </td>

                                    <!-- Input Field Column -->
                                    <td>
                                        {{ field }}
                                        
                                        <!-- Error Messages -->
                                        {% if field.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in field.errors %}
                                                    {{ error }}<br>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                            
                        </table>
                        <!-- Image Upload Row -->
                        <label for="images">Upload Images:</label>
                        <input type="file" name="images" multiple> 
                       

                         <!-- Map Picker -->
                        <div id="map" style="height: 400px; width: 100%;"></div>
                        <!-- Hidden Inputs to Store Latitude and Longitude -->
                        <input type="hidden" id="id_lat" name="lat" value="{{ form.lat.value|default:'' }}">
                        <input type="hidden" id="id_lng" name="lng" value="{{ form.lng.value|default:'' }}">
                        
                        
                        <!-- Submit Button Section -->
                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-primary w-100">Add Property</button>
                        </div>
                    </form>
                    <script>
                        function initMap() {
                            // Default center for the map (e.g., New York)
                            const defaultLocation = { lat: 40.7128, lng: -74.0060 };
                            
                            // Initialize map
                            const map = new google.maps.Map(document.getElementById('map'), {
                                center: defaultLocation,
                                zoom: 13
                            });
                    
                            // Marker for selected location
                            let marker = new google.maps.Marker({
                                position: defaultLocation,
                                map: map,
                                draggable: true
                            });
                    
                            // Update hidden inputs on marker drag
                            google.maps.event.addListener(marker, 'dragend', function (event) {
                                document.getElementById('id_lat').value = event.latLng.lat();
                                document.getElementById('id_lng').value = event.latLng.lng();
                            });
                    
                            // On map click, move the marker and update inputs
                            map.addListener('click', function (event) {
                                const clickedLocation = event.latLng;
                                marker.setPosition(clickedLocation);
                                document.getElementById('id_lat').value = clickedLocation.lat();
                                document.getElementById('id_lng').value = clickedLocation.lng();
                            });
                        }
                        // Initialize map on page load
                        window.onload = initMap;
                    </script>
                 <script src="https://maps.gomaps.pro/maps/api/js?key=AlzaSy-OIuA0NEQEdVKNSZ3Kx1LFx4ZEZ0HltMg"></script>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %} 
